        -:    0:Source:/Users/glebmitko/Desktop/lab1_minimarket/src/orders/OrderSystem.cpp
        -:    0:Graph:CMakeFiles/run_tests.dir/src/orders/OrderSystem.cpp.gcno
        -:    0:Data:CMakeFiles/run_tests.dir/src/orders/OrderSystem.cpp.gcda
        -:    0:Runs:1
        -:    0:Programs:1
        -:    1:#include "../../include/orders/OrderSystem.hpp"
        -:    2:#include "../../include/utils/Exceptions.hpp"
        -:    3:#include <algorithm>
        -:    4:
        -:    5:namespace minimarket {
        -:    6:namespace orders {
        -:    7:
        -:    8:// Order implementation
function _ZN10minimarket6orders5OrderC2ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_d called 4 returned 100% blocks executed 72%
function _ZN10minimarket6orders5OrderC1ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_d called 4 returned 100% blocks executed 100%
        8:    9:Order::Order(const std::string& id, const std::string& custId, double amount)
        8:   10:    : orderId(id), customerId(custId), orderDate(std::time(nullptr)), totalAmount(amount) {
branch  0 taken 100%
branch  1 taken 0%
branch  2 taken 100%
branch  3 taken 0%
        4:   11:    if (amount < 0) throw exceptions::InvalidOperationException("Order amount cannot be negative");
branch  0 taken 75%
branch  1 taken 25%
branch  2 taken 100%
branch  3 taken 0%
branch  4 taken 100%
branch  5 taken 0%
branch  6 taken 0%
branch  7 taken 100%
branch  8 taken 100%
branch  9 taken 0%
        9:   12:}
        -:   13:
function _ZNK10minimarket6orders5Order13validateOrderEv called 3 returned 100% blocks executed 100%
        3:   14:bool Order::validateOrder() const {
        3:   15:    return !orderId.empty() && !customerId.empty() && totalAmount > 0;
branch  0 taken 100%
branch  1 taken 0%
branch  2 taken 0%
branch  3 taken 100%
        -:   16:}
        -:   17:
function _ZNK10minimarket6orders5Order12calculateTaxEv called 2 returned 100% blocks executed 100%
        2:   18:double Order::calculateTax() const {
        2:   19:    return totalAmount * 0.08; // 8% налог
        -:   20:}
        -:   21:
function _ZNK10minimarket6orders5Order20generateOrderSummaryEv called 1 returned 100% blocks executed 36%
        1:   22:std::string Order::generateOrderSummary() const {
        2:   23:    return "Order #" + orderId + " - Total: $" + std::to_string(totalAmount) +
branch  0 taken 100%
branch  1 taken 0%
branch  2 taken 100%
branch  3 taken 0%
branch  4 taken 100%
branch  5 taken 0%
branch  6 taken 100%
branch  7 taken 0%
        1:   24:           " - Tax: $" + std::to_string(calculateTax());
branch  0 taken 100%
branch  1 taken 0%
branch  2 taken 0%
branch  3 taken 100%
    #####:   25:}
        -:   26:
        -:   27:// OrderItem implementation
function _ZN10minimarket6orders9OrderItemC2ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_id called 15 returned 100% blocks executed 73%
function _ZN10minimarket6orders9OrderItemC1ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_id called 15 returned 100% blocks executed 100%
       30:   28:OrderItem::OrderItem(const std::string& prodId, const std::string& name, int qty, double price)
       30:   29:    : productId(prodId), productName(name), quantity(qty), unitPrice(price) {
branch  0 taken 100%
branch  1 taken 0%
       15:   30:    if (qty <= 0) throw exceptions::InvalidOperationException("Quantity must be positive");
branch  0 taken 87%
branch  1 taken 13%
branch  2 taken 100%
branch  3 taken 0%
branch  4 taken 100%
branch  5 taken 0%
branch  6 taken 0%
branch  7 taken 100%
branch  8 taken 0%
branch  9 taken 100%
       32:   31:}
        -:   32:
function _ZNK10minimarket6orders9OrderItem18calculateItemTotalEv called 5 returned 100% blocks executed 100%
        5:   33:double OrderItem::calculateItemTotal() const {
        5:   34:    return quantity * unitPrice;
        -:   35:}
        -:   36:
function _ZNK10minimarket6orders9OrderItem16validateQuantityEv called 12 returned 100% blocks executed 100%
       12:   37:bool OrderItem::validateQuantity() const {
       12:   38:    return quantity > 0 && quantity <= 100;
branch  0 taken 100%
branch  1 taken 0%
        -:   39:}
        -:   40:
function _ZN10minimarket6orders9OrderItem21applyQuantityDiscountEv called 1 returned 100% blocks executed 75%
        1:   41:bool OrderItem::applyQuantityDiscount() {
        1:   42:    if (quantity >= 10) {
branch  0 taken 100%
branch  1 taken 0%
        -:   43:        // unitPrice *= 0.9; // 10% скидка за 10+ штук
        1:   44:        return true;
        -:   45:    }
    #####:   46:    return false;
        1:   47:}
        -:   48:
        -:   49:// Payment implementation
function _ZN10minimarket6orders7PaymentC2ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_dSA_ called 6 returned 100% blocks executed 40%
function _ZN10minimarket6orders7PaymentC1ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_dSA_ called 6 returned 100% blocks executed 100%
       12:   50:Payment::Payment(const std::string& payId, const std::string& ordId, double amt, const std::string& method)
       12:   51:    : paymentId(payId), orderId(ordId), amount(amt), paymentMethod(method), status("Pending") {}
branch  0 taken 100%
branch  1 taken 0%
branch  2 taken 100%
branch  3 taken 0%
branch  4 taken 0%
branch  5 taken 100%
        -:   52:
function _ZN10minimarket6orders7Payment14processPaymentEv called 6 returned 100% blocks executed 93%
        6:   53:bool Payment::processPayment() {
        6:   54:    if (amount <= 0) return false;
branch  0 taken 0%
branch  1 taken 100%
        -:   55:    
        -:   56:    // Упрощенная логика обработки платежа
        6:   57:    if (paymentMethod == "CreditCard" && amount <= 5000) {
branch  0 taken 67%
branch  1 taken 33%
branch  2 taken 25%
branch  3 taken 75%
        3:   58:        status = "Completed";
        3:   59:        return true;
        3:   60:    } else if (paymentMethod == "BankTransfer" && amount <= 10000) {
branch  0 taken 33%
branch  1 taken 67%
branch  2 taken 0%
branch  3 taken 100%
        1:   61:        status = "Completed";
        1:   62:        return true;
        2:   63:    } else if (paymentMethod == "PayPal" && amount <= 2500) {
branch  0 taken 50%
branch  1 taken 50%
branch  2 taken 100%
branch  3 taken 0%
        1:   64:        status = "Completed";
        1:   65:        return true;
        -:   66:    }
        -:   67:    
        1:   68:    status = "Failed";
        1:   69:    return false;
        6:   70:}
        -:   71:
function _ZNK10minimarket6orders7Payment13verifyPaymentEv called 1 returned 100% blocks executed 100%
        1:   72:bool Payment::verifyPayment() const {
        1:   73:    return status == "Completed" && amount > 0;
branch  0 taken 0%
branch  1 taken 100%
        -:   74:}
        -:   75:
function _ZNK10minimarket6orders7Payment27generatePaymentConfirmationEv called 1 returned 100% blocks executed 36%
        1:   76:std::string Payment::generatePaymentConfirmation() const {
        2:   77:    return "Payment #" + paymentId + " - Amount: $" + std::to_string(amount) +
branch  0 taken 100%
branch  1 taken 0%
branch  2 taken 100%
branch  3 taken 0%
branch  4 taken 100%
branch  5 taken 0%
branch  6 taken 100%
branch  7 taken 0%
        1:   78:           " - Method: " + paymentMethod + " - Status: " + status;
branch  0 taken 100%
branch  1 taken 0%
branch  2 taken 100%
branch  3 taken 0%
branch  4 taken 0%
branch  5 taken 100%
    #####:   79:}
        -:   80:
        -:   81:// Shipping implementation
function _ZN10minimarket6orders8ShippingC2ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_SA_SA_ called 7 returned 100% blocks executed 38%
function _ZN10minimarket6orders8ShippingC1ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_SA_SA_ called 7 returned 100% blocks executed 100%
       14:   82:Shipping::Shipping(const std::string& shipId, const std::string& ordId,
        -:   83:                   const std::string& addr, const std::string& method)
       14:   84:    : shippingId(shipId), orderId(ordId), address(addr), shippingMethod(method) {
branch  0 taken 100%
branch  1 taken 0%
branch  2 taken 100%
branch  3 taken 0%
branch  4 taken 100%
branch  5 taken 0%
        -:   85:    // Расчет предполагаемой даты доставки
        7:   86:    std::time_t now = std::time(nullptr);
branch  0 taken 0%
branch  1 taken 100%
        7:   87:    int daysToAdd = (shippingMethod == "Express") ? 2 : 5;
        7:   88:    estimatedDelivery = now + (daysToAdd * 24 * 60 * 60);
       14:   89:}
        -:   90:
function _ZN10minimarket6orders8Shipping16scheduleDeliveryEv called 2 returned 100% blocks executed 100%
        2:   91:bool Shipping::scheduleDelivery() {
        2:   92:    return !shippingId.empty() && !orderId.empty() && !address.empty();
branch  0 taken 100%
branch  1 taken 0%
branch  2 taken 0%
branch  3 taken 100%
        -:   93:}
        -:   94:
function _ZNK10minimarket6orders8Shipping21calculateShippingDaysEv called 3 returned 100% blocks executed 100%
        3:   95:int Shipping::calculateShippingDays() const {
        3:   96:    std::time_t now = std::time(nullptr);
        3:   97:    double secondsDiff = std::difftime(estimatedDelivery, now);
        3:   98:    return static_cast<int>(secondsDiff / (24 * 60 * 60));
        -:   99:}
        -:  100:
function _ZNK10minimarket6orders8Shipping23validateShippingAddressEv called 4 returned 100% blocks executed 100%
        4:  101:bool Shipping::validateShippingAddress() const {
        7:  102:    return !address.empty() && address.length() >= 10 &&
branch  0 taken 100%
branch  1 taken 0%
branch  2 taken 25%
branch  3 taken 75%
        3:  103:           address.find("Street") != std::string::npos;
        -:  104:}
        -:  105:
        -:  106:// ShoppingCart implementation
function _ZN10minimarket6orders12ShoppingCartC2ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_ called 5 returned 100% blocks executed 50%
function _ZN10minimarket6orders12ShoppingCartC1ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_ called 5 returned 100% blocks executed 100%
       10:  107:ShoppingCart::ShoppingCart(const std::string& id, const std::string& custId)
       10:  108:    : cartId(id), customerId(custId) {}
branch  0 taken 100%
branch  1 taken 0%
        -:  109:
function _ZN10minimarket6orders12ShoppingCart7addItemERKNSt3__110shared_ptrINS0_9OrderItemEEE called 8 returned 100% blocks executed 78%
        8:  110:bool ShoppingCart::addItem(const std::shared_ptr<OrderItem>& item) {
        8:  111:    if (!item || !item->validateQuantity()) return false;
branch  0 taken 100%
branch  1 taken 0%
branch  2 taken 0%
branch  3 taken 100%
        -:  112:    
        -:  113:    // Проверяем нет ли уже этого товара в корзине
       11:  114:    for (const auto& existingItem : items) {
branch  0 taken 36%
branch  1 taken 64%
        4:  115:        if (existingItem->getProductId() == item->getProductId()) {
branch  0 taken 100%
branch  1 taken 0%
branch  2 taken 75%
branch  3 taken 25%
        1:  116:            return false; // Товар уже в корзине
        -:  117:        }
        -:  118:    }
        -:  119:    
        7:  120:    items.push_back(item);
        7:  121:    return true;
        8:  122:}
        -:  123:
function _ZN10minimarket6orders12ShoppingCart10removeItemERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEE called 3 returned 100% blocks executed 100%
        3:  124:bool ShoppingCart::removeItem(const std::string& productId) {
        6:  125:    auto it = std::remove_if(items.begin(), items.end(),
function _ZZN10minimarket6orders12ShoppingCart10removeItemERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEEENK3$_0clINS2_10shared_ptrINS0_9OrderItemEEEEEDaRKT_ called 3 returned 100% blocks executed 100%
        6:  126:        [&](const auto& item) { return item->getProductId() == productId; });
        -:  127:    
        3:  128:    bool removed = it != items.end();
        3:  129:    items.erase(it, items.end());
        3:  130:    return removed;
        -:  131:}
        -:  132:
function _ZNK10minimarket6orders12ShoppingCart18calculateCartTotalEv called 3 returned 100% blocks executed 100%
        3:  133:double ShoppingCart::calculateCartTotal() const {
        3:  134:    double total = 0.0;
        7:  135:    for (const auto& item : items) {
branch  0 taken 57%
branch  1 taken 43%
        4:  136:        total += item->calculateItemTotal();
        -:  137:    }
        3:  138:    return total;
        -:  139:}
        -:  140:
function _ZN10minimarket6orders12ShoppingCart17applyCartDiscountEd called 4 returned 100% blocks executed 100%
        4:  141:bool ShoppingCart::applyCartDiscount(double discountPercent) {
        4:  142:    if (discountPercent < 0 || discountPercent > 50) return false;
branch  0 taken 75%
branch  1 taken 25%
branch  2 taken 33%
branch  3 taken 67%
        -:  143:    
        -:  144:    // Применяем скидку к каждому товару
        3:  145:    for (auto& item : items) {
branch  0 taken 33%
branch  1 taken 67%
        -:  146:        // Упрощенная логика применения скидки
        1:  147:        if (item->getQuantity() >= 5) {
branch  0 taken 0%
branch  1 taken 100%
        -:  148:            // Дополнительная скидка за количество
        1:  149:            discountPercent += 5;
        1:  150:        }
        -:  151:    }
        2:  152:    return true;
        4:  153:}
        -:  154:
function _ZNK10minimarket6orders12ShoppingCart12getCartItemsEv called 2 returned 100% blocks executed 52%
        2:  155:std::vector<std::string> ShoppingCart::getCartItems() const {
        2:  156:    std::vector<std::string> itemList;
        4:  157:    for (const auto& item : items) {
branch  0 taken 50%
branch  1 taken 50%
        2:  158:        itemList.push_back(item->getProductName() + " x" + std::to_string(item->getQuantity()));
branch  0 taken 100%
branch  1 taken 0%
branch  2 taken 100%
branch  3 taken 0%
branch  4 taken 100%
branch  5 taken 0%
branch  6 taken 100%
branch  7 taken 0%
branch  8 taken 0%
branch  9 taken 100%
branch 10 taken 0%
branch 11 taken 100%
        -:  159:    }
        2:  160:    return itemList;
        2:  161:}
branch  0 taken 100%
branch  1 taken 0%
        -:  162:
        -:  163:} // namespace orders
        -:  164:} // namespace minimarket
