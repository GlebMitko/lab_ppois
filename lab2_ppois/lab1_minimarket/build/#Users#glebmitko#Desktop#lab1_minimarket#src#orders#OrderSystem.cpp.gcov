        -:    0:Source:/Users/glebmitko/Desktop/lab1_minimarket/src/orders/OrderSystem.cpp
        -:    0:Graph:CMakeFiles/run_tests.dir/src/orders/OrderSystem.cpp.gcno
        -:    0:Data:CMakeFiles/run_tests.dir/src/orders/OrderSystem.cpp.gcda
        -:    0:Runs:1
        -:    0:Programs:1
        -:    1:#include "../../include/orders/OrderSystem.hpp"
        -:    2:#include "../../include/utils/Exceptions.hpp"
        -:    3:#include <algorithm>
        -:    4:
        -:    5:namespace minimarket {
        -:    6:namespace orders {
        -:    7:
        -:    8:// Order implementation
function _ZN10minimarket6orders5OrderC2ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_d called 8 returned 100% blocks executed 72%
function _ZN10minimarket6orders5OrderC1ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_d called 8 returned 100% blocks executed 100%
       16:    9:Order::Order(const std::string& id, const std::string& custId, double amount)
       16:   10:    : orderId(id), customerId(custId), orderDate(std::time(nullptr)), totalAmount(amount) {
branch  0 taken 8
branch  1 taken 0
branch  2 taken 8
branch  3 taken 0
        8:   11:    if (amount < 0) throw exceptions::InvalidOperationException("Order amount cannot be negative");
branch  0 taken 6
branch  1 taken 2
branch  2 taken 2
branch  3 taken 0
branch  4 taken 2
branch  5 taken 0
branch  6 taken 0
branch  7 taken 2
branch  8 taken 2
branch  9 taken 0
       18:   12:}
        -:   13:
function _ZNK10minimarket6orders5Order13validateOrderEv called 6 returned 100% blocks executed 100%
        6:   14:bool Order::validateOrder() const {
        6:   15:    return !orderId.empty() && !customerId.empty() && totalAmount > 0;
branch  0 taken 6
branch  1 taken 0
branch  2 taken 0
branch  3 taken 6
        -:   16:}
        -:   17:
function _ZNK10minimarket6orders5Order12calculateTaxEv called 4 returned 100% blocks executed 100%
        4:   18:double Order::calculateTax() const {
        4:   19:    return totalAmount * 0.08; // 8% налог
        -:   20:}
        -:   21:
function _ZNK10minimarket6orders5Order20generateOrderSummaryEv called 2 returned 100% blocks executed 36%
        2:   22:std::string Order::generateOrderSummary() const {
        4:   23:    return "Order #" + orderId + " - Total: $" + std::to_string(totalAmount) +
branch  0 taken 2
branch  1 taken 0
branch  2 taken 2
branch  3 taken 0
branch  4 taken 2
branch  5 taken 0
branch  6 taken 2
branch  7 taken 0
        2:   24:           " - Tax: $" + std::to_string(calculateTax());
branch  0 taken 2
branch  1 taken 0
branch  2 taken 0
branch  3 taken 2
    #####:   25:}
        -:   26:
        -:   27:// OrderItem implementation
function _ZN10minimarket6orders9OrderItemC2ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_id called 30 returned 100% blocks executed 73%
function _ZN10minimarket6orders9OrderItemC1ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_id called 30 returned 100% blocks executed 100%
       60:   28:OrderItem::OrderItem(const std::string& prodId, const std::string& name, int qty, double price)
       60:   29:    : productId(prodId), productName(name), quantity(qty), unitPrice(price) {
branch  0 taken 30
branch  1 taken 0
       30:   30:    if (qty <= 0) throw exceptions::InvalidOperationException("Quantity must be positive");
branch  0 taken 26
branch  1 taken 4
branch  2 taken 4
branch  3 taken 0
branch  4 taken 4
branch  5 taken 0
branch  6 taken 0
branch  7 taken 4
branch  8 taken 0
branch  9 taken 4
       64:   31:}
        -:   32:
function _ZNK10minimarket6orders9OrderItem18calculateItemTotalEv called 10 returned 100% blocks executed 100%
       10:   33:double OrderItem::calculateItemTotal() const {
       10:   34:    return quantity * unitPrice;
        -:   35:}
        -:   36:
function _ZNK10minimarket6orders9OrderItem16validateQuantityEv called 24 returned 100% blocks executed 100%
       24:   37:bool OrderItem::validateQuantity() const {
       24:   38:    return quantity > 0 && quantity <= 100;
branch  0 taken 24
branch  1 taken 0
        -:   39:}
        -:   40:
function _ZN10minimarket6orders9OrderItem21applyQuantityDiscountEv called 2 returned 100% blocks executed 75%
        2:   41:bool OrderItem::applyQuantityDiscount() {
        2:   42:    if (quantity >= 10) {
branch  0 taken 2
branch  1 taken 0
        -:   43:        // unitPrice *= 0.9; // 10% скидка за 10+ штук
        2:   44:        return true;
        -:   45:    }
    #####:   46:    return false;
        2:   47:}
        -:   48:
        -:   49:// Payment implementation
function _ZN10minimarket6orders7PaymentC2ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_dSA_ called 12 returned 100% blocks executed 40%
function _ZN10minimarket6orders7PaymentC1ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_dSA_ called 12 returned 100% blocks executed 100%
       24:   50:Payment::Payment(const std::string& payId, const std::string& ordId, double amt, const std::string& method)
       24:   51:    : paymentId(payId), orderId(ordId), amount(amt), paymentMethod(method), status("Pending") {}
branch  0 taken 12
branch  1 taken 0
branch  2 taken 12
branch  3 taken 0
branch  4 taken 0
branch  5 taken 12
        -:   52:
function _ZN10minimarket6orders7Payment14processPaymentEv called 12 returned 100% blocks executed 93%
       12:   53:bool Payment::processPayment() {
       12:   54:    if (amount <= 0) return false;
branch  0 taken 0
branch  1 taken 12
        -:   55:    
        -:   56:    // Упрощенная логика обработки платежа
       12:   57:    if (paymentMethod == "CreditCard" && amount <= 5000) {
branch  0 taken 8
branch  1 taken 4
branch  2 taken 2
branch  3 taken 6
        6:   58:        status = "Completed";
        6:   59:        return true;
        6:   60:    } else if (paymentMethod == "BankTransfer" && amount <= 10000) {
branch  0 taken 2
branch  1 taken 4
branch  2 taken 0
branch  3 taken 2
        2:   61:        status = "Completed";
        2:   62:        return true;
        4:   63:    } else if (paymentMethod == "PayPal" && amount <= 2500) {
branch  0 taken 2
branch  1 taken 2
branch  2 taken 2
branch  3 taken 0
        2:   64:        status = "Completed";
        2:   65:        return true;
        -:   66:    }
        -:   67:    
        2:   68:    status = "Failed";
        2:   69:    return false;
       12:   70:}
        -:   71:
function _ZNK10minimarket6orders7Payment13verifyPaymentEv called 2 returned 100% blocks executed 100%
        2:   72:bool Payment::verifyPayment() const {
        2:   73:    return status == "Completed" && amount > 0;
branch  0 taken 0
branch  1 taken 2
        -:   74:}
        -:   75:
function _ZNK10minimarket6orders7Payment27generatePaymentConfirmationEv called 2 returned 100% blocks executed 36%
        2:   76:std::string Payment::generatePaymentConfirmation() const {
        4:   77:    return "Payment #" + paymentId + " - Amount: $" + std::to_string(amount) +
branch  0 taken 2
branch  1 taken 0
branch  2 taken 2
branch  3 taken 0
branch  4 taken 2
branch  5 taken 0
branch  6 taken 2
branch  7 taken 0
        2:   78:           " - Method: " + paymentMethod + " - Status: " + status;
branch  0 taken 2
branch  1 taken 0
branch  2 taken 2
branch  3 taken 0
branch  4 taken 0
branch  5 taken 2
    #####:   79:}
        -:   80:
        -:   81:// Shipping implementation
function _ZN10minimarket6orders8ShippingC2ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_SA_SA_ called 14 returned 100% blocks executed 38%
function _ZN10minimarket6orders8ShippingC1ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_SA_SA_ called 14 returned 100% blocks executed 100%
       28:   82:Shipping::Shipping(const std::string& shipId, const std::string& ordId,
        -:   83:                   const std::string& addr, const std::string& method)
       28:   84:    : shippingId(shipId), orderId(ordId), address(addr), shippingMethod(method) {
branch  0 taken 14
branch  1 taken 0
branch  2 taken 14
branch  3 taken 0
branch  4 taken 14
branch  5 taken 0
        -:   85:    // Расчет предполагаемой даты доставки
       14:   86:    std::time_t now = std::time(nullptr);
branch  0 taken 0
branch  1 taken 14
       14:   87:    int daysToAdd = (shippingMethod == "Express") ? 2 : 5;
       14:   88:    estimatedDelivery = now + (daysToAdd * 24 * 60 * 60);
       28:   89:}
        -:   90:
function _ZN10minimarket6orders8Shipping16scheduleDeliveryEv called 4 returned 100% blocks executed 100%
        4:   91:bool Shipping::scheduleDelivery() {
        4:   92:    return !shippingId.empty() && !orderId.empty() && !address.empty();
branch  0 taken 4
branch  1 taken 0
branch  2 taken 0
branch  3 taken 4
        -:   93:}
        -:   94:
function _ZNK10minimarket6orders8Shipping21calculateShippingDaysEv called 6 returned 100% blocks executed 100%
        6:   95:int Shipping::calculateShippingDays() const {
        6:   96:    std::time_t now = std::time(nullptr);
        6:   97:    double secondsDiff = std::difftime(estimatedDelivery, now);
        6:   98:    return static_cast<int>(secondsDiff / (24 * 60 * 60));
        -:   99:}
        -:  100:
function _ZNK10minimarket6orders8Shipping23validateShippingAddressEv called 8 returned 100% blocks executed 100%
        8:  101:bool Shipping::validateShippingAddress() const {
       14:  102:    return !address.empty() && address.length() >= 10 &&
branch  0 taken 8
branch  1 taken 0
branch  2 taken 2
branch  3 taken 6
        6:  103:           address.find("Street") != std::string::npos;
        -:  104:}
        -:  105:
        -:  106:// ShoppingCart implementation
function _ZN10minimarket6orders12ShoppingCartC2ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_ called 10 returned 100% blocks executed 50%
function _ZN10minimarket6orders12ShoppingCartC1ERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEESA_ called 10 returned 100% blocks executed 100%
       20:  107:ShoppingCart::ShoppingCart(const std::string& id, const std::string& custId)
       20:  108:    : cartId(id), customerId(custId) {}
branch  0 taken 10
branch  1 taken 0
        -:  109:
function _ZN10minimarket6orders12ShoppingCart7addItemERKNSt3__110shared_ptrINS0_9OrderItemEEE called 16 returned 100% blocks executed 78%
       16:  110:bool ShoppingCart::addItem(const std::shared_ptr<OrderItem>& item) {
       16:  111:    if (!item || !item->validateQuantity()) return false;
branch  0 taken 16
branch  1 taken 0
branch  2 taken 0
branch  3 taken 16
        -:  112:    
        -:  113:    // Проверяем нет ли уже этого товара в корзине
       22:  114:    for (const auto& existingItem : items) {
branch  0 taken 8
branch  1 taken 14
        8:  115:        if (existingItem->getProductId() == item->getProductId()) {
branch  0 taken 8
branch  1 taken 0
branch  2 taken 6
branch  3 taken 2
        2:  116:            return false; // Товар уже в корзине
        -:  117:        }
        -:  118:    }
        -:  119:    
       14:  120:    items.push_back(item);
       14:  121:    return true;
       16:  122:}
        -:  123:
function _ZN10minimarket6orders12ShoppingCart10removeItemERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEE called 6 returned 100% blocks executed 100%
        6:  124:bool ShoppingCart::removeItem(const std::string& productId) {
       12:  125:    auto it = std::remove_if(items.begin(), items.end(),
function _ZZN10minimarket6orders12ShoppingCart10removeItemERKNSt3__112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEEENK3$_0clINS2_10shared_ptrINS0_9OrderItemEEEEEDaRKT_ called 6 returned 100% blocks executed 100%
       12:  126:        [&](const auto& item) { return item->getProductId() == productId; });
        -:  127:    
        6:  128:    bool removed = it != items.end();
        6:  129:    items.erase(it, items.end());
        6:  130:    return removed;
        -:  131:}
        -:  132:
function _ZNK10minimarket6orders12ShoppingCart18calculateCartTotalEv called 6 returned 100% blocks executed 100%
        6:  133:double ShoppingCart::calculateCartTotal() const {
        6:  134:    double total = 0.0;
       14:  135:    for (const auto& item : items) {
branch  0 taken 8
branch  1 taken 6
        8:  136:        total += item->calculateItemTotal();
        -:  137:    }
        6:  138:    return total;
        -:  139:}
        -:  140:
function _ZN10minimarket6orders12ShoppingCart17applyCartDiscountEd called 8 returned 100% blocks executed 100%
        8:  141:bool ShoppingCart::applyCartDiscount(double discountPercent) {
        8:  142:    if (discountPercent < 0 || discountPercent > 50) return false;
branch  0 taken 6
branch  1 taken 2
branch  2 taken 2
branch  3 taken 4
        -:  143:    
        -:  144:    // Применяем скидку к каждому товару
        6:  145:    for (auto& item : items) {
branch  0 taken 2
branch  1 taken 4
        -:  146:        // Упрощенная логика применения скидки
        2:  147:        if (item->getQuantity() >= 5) {
branch  0 taken 0
branch  1 taken 2
        -:  148:            // Дополнительная скидка за количество
        2:  149:            discountPercent += 5;
        2:  150:        }
        -:  151:    }
        4:  152:    return true;
        8:  153:}
        -:  154:
function _ZNK10minimarket6orders12ShoppingCart12getCartItemsEv called 4 returned 100% blocks executed 52%
        4:  155:std::vector<std::string> ShoppingCart::getCartItems() const {
        4:  156:    std::vector<std::string> itemList;
        8:  157:    for (const auto& item : items) {
branch  0 taken 4
branch  1 taken 4
        4:  158:        itemList.push_back(item->getProductName() + " x" + std::to_string(item->getQuantity()));
branch  0 taken 4
branch  1 taken 0
branch  2 taken 4
branch  3 taken 0
branch  4 taken 4
branch  5 taken 0
branch  6 taken 4
branch  7 taken 0
branch  8 taken 0
branch  9 taken 4
branch 10 taken 0
branch 11 taken 4
        -:  159:    }
        4:  160:    return itemList;
        4:  161:}
branch  0 taken 4
branch  1 taken 0
        -:  162:
        -:  163:} // namespace orders
        -:  164:} // namespace minimarket
